<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ChatGPT quick question</title>
    <meta name="description"
          content="Ask a quick question and get a response from ChatGPT, without actually having a chat.">
    <link href="//cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
<!-- Bootstrap two tabs, one called question, one called history -->
<!-- https://getbootstrap.com/docs/5.0/components/navs-tabs/ -->
<!-- https://getbootstrap.com/docs/5.0/components/navs-tabs/#javascript-behavior -->

<div class="container-xxl">
    <div class="row">
        <div class="col-sm-12">
            <nav>
                <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-question-tab" data-bs-toggle="tab"
                            data-bs-target="#nav-question"
                            type="button" role="tab" aria-controls="nav-question" aria-selected="true">Question
                    </button>
                    <button class="nav-link" id="nav-history-tab" data-bs-toggle="tab" data-bs-target="#nav-history"
                            type="button"
                            role="tab" aria-controls="nav-history" aria-selected="false">History
                    </button>
                </div>
            </nav>
            <div class="tab-content" id="nav-tabContent">
                <div class="tab-pane fade show active" id="nav-question" role="tabpanel"
                     aria-labelledby="nav-question-tab">

                    <div class="card">
                        <div class="card-header">
                            Ask a single question to ChatGPT (no chat, just one-shot, but much quicker than the chat)
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="question" class="form-label">Question</label>
                                <textarea class="form-control" id="question" rows="3" autofocus></textarea>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="ask()">Ask</button>
                            <button type="button" class="btn btn-primary" onclick="clear()">Clear</button>
                        </div>
                    </div>
                    <br>
                    <div class="card">
                        <div class="card-header">
                            Answer
                        </div>
                        <div class="card-body answers">
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="nav-history" role="tabpanel" aria-labelledby="nav-history-tab">
                    <div class="card">
                        <div class="card-header">
                            History
                        </div>
                        <div class="card-body history">
                            thehistory
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="//cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
<script
        src="//code.jquery.com/jquery-3.6.4.min.js"
        integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8="
        crossorigin="anonymous"></script>
<script>
    const $answers = $('div.answers');
    const $question = $('#question');
    // make key binding for $question so that pressing enter submits the question
    $question.keypress(function (e) {
        if (e.which == 13 && !e.shiftKey) {
            ask();
            return false;
        }
    });

    function ask() {
        var question = $("#question").val();
        // fetch api key from local storage, or else prompt if not found
        var api_key = localStorage.getItem('api_key');
        if (!api_key) {
            api_key = prompt("Please enter your API key, which you can create in your profile at https://platform.openai.com/");
            localStorage.setItem('api_key', api_key);
        }
        removeAnswers();
        $answers.append('<p>Thinking...</p>');
        $.ajax({
            url: 'https://api.openai.com/v1/chat/completions',
            type: 'POST',
            dataType: 'json',
            headers: {
                'Authorization': 'Bearer ' + api_key,
                'Content-Type': 'application/json',
            },
            data: JSON.stringify({
                model: "gpt-3.5-turbo",
                messages: [{"role": "user", "content": question}],
            }),
            success: success,
            error: error
        });
    }

    function success(data) {
        console.log(data);
        removeAnswers();
        for (var i = 0; i < data.choices.length; i++) {
            var text = data.choices[i].message.content;
            // split text into paragraphs whereever there are two consecutive newlines and add a paragraph for each to the answers div
            var paragraphs = text.split(/\n\n/);
            for (var j = 0; j < paragraphs.length; j++) {
                var paragraph = paragraphs[j];
                // if paragraph is not empty, add it to the answers div
                if (paragraph) {
                    var $p = $('<p></p>');
                    $p.text(paragraph);
                    $answers.append($p);
                }
            }
        }
    }

    function error(xhr, status, error) {
        console.log(error);
        removeAnswers();
        if (xhr.responseJSON) {
            $answers.text(JSON.stringify(xhr.responseJSON));
        } else {
            $answers.text(status || error);
        }
    }

    function removeAnswers() {
        $answers.empty();
    }

    function clear() {
        $question.val('');
        removeAnswers();
    }
</script>

</body>
</html>
