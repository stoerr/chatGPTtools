<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ChatGPT Bookmarklet - HPS' ChatGPT Tools</title>
    <meta name="description" content="ChatGPT Bookmarklet for summarizing and asking questions about web page content">
    <link href="//cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
    <link rel="canonical" href="https://chatGPTtools.stoerr.net/ChatGPTBookmarklet/"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css"/>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-SL01MYCNDC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());

        gtag('config', 'G-SL01MYCNDC');
    </script>
    <style>.github-fork-ribbon:before {
        background-color: #090;
    }</style>
</head>
<body>
<div class="container-xxl">
    <div class="row">
        <div class="col-xs-12">
            <div class="card">
                <h1 class="card-header">ChatGPT Bookmarklet</h1>
                <div class="card-body">
                    <a class="github-fork-ribbon" href="https://github.com/stoerr/chatGPTtools"
                       data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>

                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="../index.html">HPS' ChatGPT Tools</a></li>
                            <li class="breadcrumb-item active" aria-current="page">ChatGPT Bookmarklet</li>
                        </ol>
                    </nav>

                    <p class="card-text">
                        This bookmarklet allows you to send the text of any page to ChatGPT for summarization. You can
                        also ask any
                        followup question on the content.
                        It has growing functionality - see the help for details.
                        See also my blog <a href="http://www.stoerr.net/blog/2023-04-10-readingWithChatGPT.html">Reading
                        with ChatGPT</a> about this.
                    </p>

                    <p>
                        You'll need your own ChatGPT API key to run that, which you can get at <a
                            href="//platform.openai.com/">https://platform.openai.com/</a>.
                        After logging in there with your ChatGPT credentials, you can create an API key in the
                        profile settings (top right corner) at "View API keys".
                        Enter that in the field below. Don't worry - that is just put into the bookmarklet, not
                        transmitted anywhere, except to OpenAI's API when using the bookmarklet.
                    </p>

                    <div class="mb-3">
                        <label for="chatgptapikey" class="form-label">ChatGPT API Key (Optional if using advanced configuration)</label>
                        <input type="text" class="form-control" id="chatgptapikey" rows="1" autofocus
                               onchange="makeChatGPTLet(this);"></textarea>
                    </div>

                    <!-- Advanced Configuration Section (Collapsible) -->
                    <div class="mb-3">
                        <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#advancedConfig" aria-expanded="false" aria-controls="advancedConfig">
                            Advanced Configuration (Optional)
                        </button>
                        <div class="collapse" id="advancedConfig">
                            <div class="card card-body mt-2">
                                <label for="chatgptconfig" class="form-label">Backends configuration (Optional JSON)</label>
                                <p>
                                    Enter configuration as JSON for multiple AI backends. Leave empty to use default OpenAI configuration with the API key above.<br>
                                    You can override the list of models for each backend by specifying a <code>models</code>
                                    array in the backend configuration.
                                    If <code>models</code> is not set the backends list models API call will be used. Example:
                                <pre style="background:#f6f6f6;padding:8px;border-radius:4px;white-space:pre-wrap;">
{"backends": [
    {
      "name": "OpenAI", "baseUrl": "https://api.openai.com/v1",
      "defaultModel": "gpt-4.1",
      "headers": [{ "name": "Authorization", "value": "Bearer YOUR_API_KEY" }]
    },
    { "name": "Local", "baseUrl": "http://localhost:8000", "models": ["mistral-7b", "llama-2-13b"],
      "autoselect": ".*intranet.*" }
]}
                </pre>
                                </p>
                                <textarea class="form-control" id="chatgptconfig" rows="10"
                                          placeholder='{"backends": [{"name": "OpenAI", "baseUrl": "https://api.openai.com/v1", "headers": [{"name": "Authorization", "value": "Bearer YOUR_API_KEY"}]}]}'
                                          onchange="makeChatGPTLet(this);"></textarea>
                                <div class="form-text">
                                    <strong>Backend Selection:</strong> The first backend is selected by default. Use <code>autoselect</code> regex patterns to automatically select backends based on page URL.
                                </div>
                            </div>
                        </div>
                    </div>

                    <p class="card-text">Bookmarklet to drag: <a id="chatgptbookmarklet">Enter a ChatGPT API Key
                        first.</a> <br/>
                        (If you want a quick preview of the dialog, you can
                        <a id="bookmarkletpreview">click here</a>.
                        However, that doesn't really work until you enter a working API key.)
                    </p>

                    <hr>

                    <h4 class="card-subtitle mb-2">About</h4>
                    <p class="card-text">
                        This is part of my <a href="https://github.com/stoerr/chatGPTtools">ChatGPT tools</a>
                        collection.
                        For more tools and information, visit the <a href="../index.html">main page</a>.
                    </p>

                    <p>If you have problems, please contact me, <a href="http://www.stoerr.net/">Hans-Peter St√∂rr</a>.
                        See also my <a href="https://github.com/stoerr">other projects on Github</a>,
                        links to <a href="https://www.stoerr.net/ai.html">AI related projects</a> and
                        <a href="https://www.stoerr.net/blog.html">my blog</a>.
                    </p>

                </div>
            </div>
        </div>
    </div>
</div>

<script src="//cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

<script>
    const baseurl = (location.protocol + '//' + location.host + location.pathname.replace("/index.html", ""));

    // Handle hash parameters on page load
    window.addEventListener('load', function () {
        if (window.location.hash) {
            try {
                const params = new URLSearchParams(window.location.hash.slice(1));
                const apikey = params.get('apikey');
                const config = params.get('config');

                if (apikey) {
                    document.getElementById('chatgptapikey').value = apikey;
                }
                if (config) {
                    // Pretty print the JSON configuration for better readability
                    const configObj = JSON.parse(decodeURIComponent(config));
                    document.getElementById('chatgptconfig').value = JSON.stringify(configObj, null, 2);

                    // Expand the advanced configuration section since we have config data
                    const advancedConfigCollapse = document.getElementById('advancedConfig');
                    const advancedConfigButton = document.querySelector('[data-bs-target="#advancedConfig"]');
                    advancedConfigCollapse.classList.add('show');
                    advancedConfigButton.setAttribute('aria-expanded', 'true');
                }

                // Generate bookmarklet with pre-filled data
                makeChatGPTLet();

                // Immediately clean the URL from browser history
                history.replaceState({}, document.title, window.location.pathname);
            } catch (e) {
                console.error('Error parsing hash parameters:', e);
            }
        }
    });

    function load(basePath, apikey, config) {
        if (!window.hpsChatGPTBookmarklet) {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = basePath + '/ChatGPTBookmarklet.js';
            script.onload = function () {
                window.hpsChatGPTBookmarklet.init(basePath, apikey, window.hpsChatGPTBookmarklet.openDialog, config);
            };
            document.body.appendChild(script);
        } else {
            window.hpsChatGPTBookmarklet.openDialog();
        }
    }

    function makeChatGPTLet() {
        var apikey = document.getElementById("chatgptapikey").value;
        var config = document.getElementById("chatgptconfig").value;
        var element = document.getElementById("chatgptbookmarklet");
        var preview = document.getElementById("bookmarkletpreview");
        debugger;

        // Validate config JSON if provided
        var configObj = null;
        var hasAdvancedConfig = false;
        if (config.trim()) {
            try {
                configObj = JSON.parse(config);
                hasAdvancedConfig = configObj && configObj.backends && configObj.backends.length > 0;
            } catch (e) {
                element.innerText = "Invalid JSON configuration.";
                preview.removeAttribute("href");
                return;
            }
        }

        // API key is required only if no advanced backend configuration is provided
        var needsApiKey = !hasAdvancedConfig;
        var hasValidApiKey = apikey && apikey.startsWith('sk-') && apikey.trim().length >= 51;
        var hasValidConfig = hasValidApiKey || hasAdvancedConfig;

        var bookmarklet = "javascript:" + encodeURIComponent(
            "/*ChatGPTBookmarklet*/(function () {" +
            load.toString() +
            "\nload('THEURL', 'THEKEY', THECONFIG);" +
            "})()"
        )
        var url = baseurl;
        // Compact JSON for bookmarklet (no pretty printing)
        var configStr = configObj ? JSON.stringify(configObj) : 'null';
        // Use API key if provided, otherwise use empty string for advanced configs
        var apikeyStr = hasValidApiKey ? apikey.trim() : '';
        var finalBookmarklet = bookmarklet
            .replace("THEURL", encodeURIComponent(url))
            .replace('THEKEY', apikeyStr)
            .replace('THECONFIG', configStr);
        console.log("Bookmarklet: " + finalBookmarklet);

        // Main bookmarklet only gets href and proper text if there's valid config
        if (hasValidConfig) {
            element.setAttribute("href", finalBookmarklet);
            element.innerText = "ChatGPT Bookmarklet";
        } else {
            element.removeAttribute("href");
            element.innerText = "Enter a ChatGPT API Key first, or provide advanced backend configuration.";
        }

        // Preview always gets the href for partial functionality
        preview.setAttribute("href", finalBookmarklet);
    }

    makeChatGPTLet();
</script>

</body>
</html>
